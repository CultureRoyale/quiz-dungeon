<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/layout}">

<head>
    <title>Boutique</title>
</head>

<body>

    <main layout:fragment="content" class="flex-grow flex items-center justify-center p-4">
        <div class="w-full max-w-7xl p-8 border border-gray-600 bg-gray-900 shadow-2xl relative">
            <h1 class="text-3xl text-center mb-4 font-dungeon tracking-wider flex items-center justify-center gap-2">
                Boutique
                <div class="group relative inline-block">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6 text-gray-400 cursor-help">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                    </svg>
                    <div
                        class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block w-96 bg-gray-800 text-white text-xs rounded p-2 text-center border border-gray-600 shadow-lg z-50 font-sans normal-case tracking-normal">
                        <span class="align-middle">Un achat termine un combat ou un raid en cours</span>
                        <img th:src="@{/images/mimimi.webp}" alt="mimimi"
                            class="w-16 h-16 inline-block mr-1 align-middle">
                    </div>
                </div>
            </h1>
            <div class="border-b-2 border-white mb-8"></div>

            <!-- User HP Bar Fragment -->
            <div class="w-full mb-8">
                <div th:replace="~{fragments/user_hp_bar :: userHpBar(user=${user})}"></div>
            </div>

            <!-- Toast Fragment -->
            <div th:replace="~{fragments/toast :: toast}"></div>
            <div th:replace="~{fragments/toast :: toast-script}"></div>

            <!-- Trigger Toast from Server Messages -->
            <!-- Trigger Toast from Server Messages -->


            <div class="space-y-12">

                <!-- Boosts Row -->
                <div class="relative">
                    <h2 class="absolute -top-6 left-0 text-gray-400 font-dungeon tracking-wider text-sm uppercase">
                        Boosts</h2>
                    <div class="border-t border-gray-600 pt-6 flex flex-row gap-12 justify-center flex-wrap">

                        <!-- Potion -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/potion.png}" alt="Potion"
                                    class="w-full h-32 object-contain mb-4 drop-shadow-[0_0_10px_rgba(168,85,247,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Potion <br><span
                                    class="text-green-400 text-sm">(+20 pv)</span></h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('potion')|">
                                <button th:replace="~{fragments/button :: shopButton('30')}"></button>
                            </div>
                        </div>

                        <!-- Super Potion -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/potion.png}" alt="Super Potion"
                                    class="w-full h-32 object-contain mb-4 drop-shadow-[0_0_10px_rgba(236,72,153,0.5)] hue-rotate-90"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Super Potion
                                <br><span class="text-green-400 text-sm">(+60 pv)</span>
                            </h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('super_potion')|">
                                <button th:replace="~{fragments/button :: shopButton('67')}"></button>
                            </div>
                        </div>

                        <!-- Dague -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/cannon.webp}" alt="Cannon"
                                    class="w-full h-32 object-contain mb-4 drop-shadow-[0_0_10px_rgba(59,130,246,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Cannon <br><span
                                    class="text-red-500 text-sm">(+20% Boost donjon)</span></h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('cannon')|">
                                <button th:replace="~{fragments/button :: shopButton('100')}"></button>
                            </div>
                        </div>

                        <!-- Piment -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/chili.png}" alt="Piment"
                                    class="w-full h-32 object-contain mb-4 drop-shadow-[0_0_10px_rgba(239,68,68,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Piment <br><span
                                    class="text-green-400 text-sm">(-50pv, </span><span class="text-red-500 text-sm">+50
                                    Boost)</span></h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('chili')|">
                                <button th:replace="~{fragments/button :: shopButton('200')}"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cosmetics Row -->
                <div class="relative">
                    <h2 class="absolute -top-6 left-0 text-gray-400 font-dungeon tracking-wider text-sm uppercase">
                        Cosmétiques</h2>
                    <div class="border-t border-gray-600 pt-6 flex flex-row gap-12 justify-center flex-wrap">

                        <!-- Tiki -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/theme_tiki.png}" alt="Tiki"
                                    class="w-full h-32 object-cover rounded-lg mb-4 shadow-[0_0_10px_rgba(251,191,36,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Thème Tiki</h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('theme_tiki')|">
                                <button th:replace="~{fragments/button :: shopButton('1000')}"></button>
                            </div>
                        </div>

                        <!-- Lava -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/theme_lava.png}" alt="Lava"
                                    class="w-full h-32 object-cover rounded-lg mb-4 shadow-[0_0_10px_rgba(249,115,22,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Thème Lava</h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('theme_lava')|">
                                <button th:replace="~{fragments/button :: shopButton('1000')}"></button>
                            </div>
                        </div>

                        <!-- Gold -->
                        <div class="flex flex-col items-center group w-40">
                            <div class="w-20 h-20 mb-4 transition-transform group-hover:scale-110 duration-300">
                                <img th:src="@{/images/shop/theme_gold.png}" alt="Gold"
                                    class="w-full h-32 object-cover rounded-lg mb-4 shadow-[0_0_10px_rgba(250,204,21,0.5)]"
                                    loading="lazy">
                            </div>
                            <h3 class="font-dungeon text-xl text-white mb-1 text-center leading-tight">Thème Gold</h3>
                            <div class="mt-auto pt-2" th:onclick="|buyItem('theme_gold')|">
                                <button th:replace="~{fragments/button :: shopButton('1000')}"></button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <th:block layout:fragment="scripts">
        <script>
            function buyItem(item) {
                const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
                const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

                fetch('/shop/buy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        [csrfHeader]: csrfToken
                    },
                    body: 'item=' + item
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showToast(data.message, 'success');
                            updateUserStats(data);
                        } else {
                            showToast(data.message, 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast('Erreur de communication avec le serveur', 'error');
                    });
            }

            function updateUserStats(data) {
                const goldEl = document.getElementById('user-gold');
                const hpTextEl = document.getElementById('user-hp-text');
                const hpProgressEl = document.getElementById('user-hp-progress');
                const damageBoostEl = document.getElementById('user-damage-boost');

                if (goldEl) goldEl.textContent = data.gold;

                if (hpTextEl) hpTextEl.textContent = 'Hp : ' + data.currentHp + '/' + data.maxHp;

                if (hpProgressEl) {
                    const percentage = (data.currentHp / data.maxHp) * 100;
                    hpProgressEl.style.width = percentage + '%';
                }

                if (damageBoostEl && data.damageBoost !== undefined) {
                    damageBoostEl.textContent = '+' + data.damageBoost + '%';
                }
            }
        </script>
    </th:block>
</body>

</html>