<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>

    <div th:fragment="list" class="flex flex-col gap-4 animate-fade-in">
        <div th:each="choice, iterStat : ${choices}" th:data-choice-index="${iterStat.index}"
            class="choice-item relative transition-all duration-500">

            <input type="radio" name="choiceId" th:value="${choice.id}" th:id="${'choice-' + choice.id}"
                class="peer hidden" th:checked="${choice.id == selectedChoiceId}"
                th:disabled="${submittedChoiceId != null}" required>

            <!-- Label with conditional styling based on result -->
            <label th:for="${'choice-' + choice.id}"
                th:class="'flex items-center w-full p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 group ' + 
                   (${submittedChoiceId != null} ? 
                        (${choice.id == correctChoiceId} ? 'bg-gray-800 border-green-500' : 
                            (${choice.id == submittedChoiceId} ? 'bg-gray-800 border-red-500' : 'bg-gray-900 border-gray-700 opacity-50')) 
                   : 'bg-gray-900 border-gray-700 hover:bg-gray-800 hover:border-gray-600 peer-checked:border-amber-400 peer-checked:bg-gray-800 peer-checked:[&_.sword-indicator]:block peer-checked:[&_.dot-indicator]:hidden peer-checked:[&_.text-content]:text-white')">

                <!-- Icon Container -->
                <div class="w-12 flex justify-center items-center mr-4 shrink-0">
                    <!-- Dot (Hidden if selected or result shown) -->
                    <div
                        th:class="'dot-indicator w-3 h-3 rounded-full bg-gray-600 group-hover:bg-gray-500 transition-colors ' + 
                        (${submittedChoiceId != null && (choice.id == correctChoiceId || choice.id == submittedChoiceId)} ? 'hidden' : 'block')">
                    </div>

                    <!-- Sword (Shown if selected and no result yet) -->
                    <img src="/images/sword.svg" alt="Selected" class="sword-indicator w-8 h-8 hidden animate-pulse"
                        th:if="${submittedChoiceId == null}">

                    <!-- Result Icons -->
                    <span th:if="${submittedChoiceId != null && choice.id == correctChoiceId}"
                        class="text-green-500 text-2xl">✓</span>
                    <span
                        th:if="${submittedChoiceId != null && choice.id == submittedChoiceId && choice.id != correctChoiceId}"
                        class="text-red-500 text-2xl">✗</span>
                </div>

                <!-- Text -->
                <span th:class="'text-content text-xl font-bold transition-colors ' + 
                      (${submittedChoiceId != null} ? 
                           (${choice.id == correctChoiceId} ? 'text-green-500' : 
                               (${choice.id == submittedChoiceId} ? 'text-red-500' : 'text-gray-500')) 
                      : 'text-gray-400 group-hover:text-gray-300')" th:text="${choice.text}">
                    Choice Text
                </span>
            </label>
        </div>

        <!-- Action Section: Submit Button OR Result Message -->
        <div class="mt-8">
            <!-- Submit Button (Show if not submitted) -->
            <button th:if="${submittedChoiceId == null}" type="button" onclick="submitAnswer('choice')"
                class="w-full bg-gradient-to-b from-yellow-400 to-orange-500 hover:from-yellow-300 hover:to-orange-400 text-white font-dungeon text-2xl py-3 rounded-lg border-2 border-yellow-200 shadow-[0_4px_0_rgb(194,65,12)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-wider drop-shadow-md">
                <span class="drop-shadow-[0_2px_2px_rgba(0,0,0,0.2)]">Valider</span>
            </button>

            <!-- Continue Button (Show if submitted) -->
            <button th:if="${submittedChoiceId != null}" type="button" onclick="location.reload()"
                class="w-full bg-gradient-to-b from-yellow-400 to-orange-500 hover:from-yellow-300 hover:to-orange-400 text-white font-dungeon text-2xl py-3 rounded-lg border-2 border-yellow-200 shadow-[0_4px_0_rgb(194,65,12)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-wider drop-shadow-md">
                <span class="drop-shadow-[0_2px_2px_rgba(0,0,0,0.2)]">Continuer</span>
            </button>
        </div>

        <!-- Back Button (Only if not submitted) -->
        <button th:if="${submittedChoiceId == null}" onclick="resetInterface()"
            class="mt-4 text-gray-500 hover:text-white text-sm uppercase tracking-widest transition-colors text-center w-full">
            Retour
        </button>
    </div>

</body>

</html>